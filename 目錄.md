tcm-cbr-agent/
├── config/
│   ├── __init__.py
│   ├── settings.py                 # 系統配置(API金鑰、模型參數)
│   ├── prompts.yaml               # 各Agent的提示詞模板
│   └── tcm_knowledge.json         # 中醫基礎知識庫(證型、方劑等)
│
├── agents/
│   ├── __init__.py
│   ├── base_agent.py              # Agent基礎類別(統一API調用接口)
│   ├── intake_agent.py            # 模組1: 信息採集與結構化Agent
│   ├── pathogenesis_agent.py     # 模組2: 病機推理Agent
│   ├── retrieval_agent.py        # 模組3: 案例檢索Agent
│   ├── diagnosis_agent.py        # 模組4: 辨證論治Agent
│   └── explanation_agent.py      # 模組5: 推理解釋Agent
│
├── cbr/
│   ├── __init__.py
│   ├── retrieve.py                # CBR檢索模組
│   ├── reuse.py                   # CBR重用模組
│   ├── revise.py                  # CBR修正模組
│   └── retain.py                  # CBR保留模組
│
├── knowledge/
│   ├── __init__.py
│   ├── case_database.py           # 案例庫管理
│   ├── vector_store.py            # 向量資料庫封裝(FAISS/Chroma)
│   ├── symptom_extractor.py      # 症狀提取與標準化
│   └── similarity_calculator.py   # 案例相似度計算
│
├── workflow/
│   ├── __init__.py
│   ├── router.py                  # Agent路由控制器
│   ├── pipeline.py                # 順序工作流編排
│   └── state_manager.py           # 狀態與上下文管理
│
├── data/
│   ├── cases/
│   │   ├── case_library.json      # 歷史案例庫
│   │   └── embeddings.pkl         # 案例向量嵌入
│   ├── tcm_terms/
│   │   ├── symptoms.json          # 症狀術語庫
│   │   ├── syndromes.json         # 證型知識庫
│   │   └── formulas.json          # 方劑資料庫
│   └── feedback/
│       └── treatment_outcomes.json # 療效反饋數據
│
├── utils/
│   ├── __init__.py
│   ├── text_processor.py          # 文本預處理工具
│   ├── json_handler.py            # JSON數據處理
│   ├── logger.py                  # 日誌記錄
│   └── validators.py              # 輸入驗證工具
│
├── api/
│   ├── __init__.py
│   ├── app.py                     # FastAPI/Flask主應用
│   ├── routes.py                  # API路由定義
│   └── schemas.py                 # 請求/響應數據模型
│
├── tests/
│   ├── test_agents.py             # Agent單元測試
│   ├── test_cbr.py                # CBR流程測試
│   └── test_workflow.py           # 工作流測試
│
├── docs/
│   ├── architecture.md            # 系統架構說明
│   ├── api_reference.md           # API文檔
│   └── prompt_design.md           # 提示詞設計文檔
│
├── main.py                        # 主程式入口
├── requirements.txt               # Python依賴套件
├── README.md                      # 專案說明
└── .env                           # 環境變數(API金鑰等)



核心檔案功能說明
agents/ 目錄
base_agent.py: 定義Agent基礎類,封裝LLM API調用、錯誤處理、重試機制​

intake_agent.py: 引導醫師輸入,將自由文本轉為結構化四診數據(JSON格式)

pathogenesis_agent.py: 分析症狀關聯,推斷病因病機和臟腑定位

retrieval_agent.py: 基於當前症狀特徵,從向量資料庫檢索Top-K相似案例

diagnosis_agent.py: 綜合四診、病機、歷史案例生成辨證結論和治療方案

explanation_agent.py: 生成符合中醫理論的推理過程說明

cbr/ 目錄
retrieve.py: 實現案例檢索邏輯,調用vector_store進行語義搜索​

reuse.py: 從檢索到的案例中提取可重用的診療方案和辨證邏輯

revise.py: 根據新舊案例差異調整方案,支持醫師人工修正接口

retain.py: 將新案例、診療方案、療效反饋寫入案例庫並更新向量索引

workflow/ 目錄
router.py: 根據當前階段動態選擇Agent和對應Prompt模板​

pipeline.py: 編排模組1→2→3→4→5的順序執行流程,傳遞中間結果​

state_manager.py: 管理整個診斷流程的上下文狀態,累積各模組輸出

knowledge/ 目錄
case_database.py: 案例庫的CRUD操作(創建、讀取、更新、刪除)

vector_store.py: 封裝FAISS或Chroma向量資料庫,支持語義檢索

symptom_extractor.py: 使用NLP從文本提取標準化中醫症狀術語

similarity_calculator.py: 計算新案例與歷史案例的相似度(向量餘弦、加權特徵等)

api/ 目錄
app.py: 創建Web服務(FastAPI推薦),定義啟動邏輯

routes.py: 定義API端點(如POST /diagnose, GET /cases/{id})

schemas.py: 使用Pydantic定義輸入輸出數據格式

config/ 目錄
settings.py: 載入環境變數,配置模型名稱、溫度參數、最大tokens等

prompts.yaml: 集中管理各Agent的System Prompt,便於調整優化

tcm_knowledge.json: 存儲中醫基礎知識(八綱辨證、六經辨證等框架)